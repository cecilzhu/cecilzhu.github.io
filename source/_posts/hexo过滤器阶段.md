---
title: hexoè¿‡æ»¤å™¨é˜¶æ®µ
date: 2024-12-15 11:11:50
permalink:
updated: 2024-12-15 11:11:50
tags: hexo
categories: å­¦ä¹ 
top:
swiper_index:
top_group_index:
cover:
main_color: '#b3bfe0'
comments:
aside:
copyright:
copyright_url:
copyright_author:
description: hexo gé˜¶æ®µ,hexoè¿‡æ»¤å™¨é˜¶æ®µ,ä»¥åŠå¤‡ä»½ï¼ˆ`filters`ã€`events`ã€`helpers`ç­‰ï¼‰ä¸åŒç±»å‹çš„hexoè„šæœ¬ï¼Œåœ¨hexoåŠ è½½æ—¶ï¼Œå¯èƒ½æœ‰ä¸åŒç¨‹åº¦çš„å½±å“ã€‚
---

[TOC]

## ä¸€ã€hexo gé˜¶æ®µ

### ä»¥ä¸‹æ˜¯ Hexo ä¸­å¸¸ç”¨çš„è¿‡æ»¤å™¨é˜¶æ®µåŠå…¶ æ‰§è¡Œé¡ºåº çš„è¡¨æ ¼è¯´æ˜ï¼ŒæŒ‰æ‰§è¡Œé¡ºåºæ’åˆ—ï¼š

<div id = "md-table">

| **é˜¶æ®µåç§°**         | **è§¦å‘æ—¶æœº**                              | **æ‰§è¡Œé¡ºåº** | **æè¿°**                                                     |
| -------------------- | ----------------------------------------- | ------------ | ------------------------------------------------------------ |
| `before_post_render` | åœ¨æ¸²æŸ“æ–‡ç« ï¼ˆå¦‚ Markdown è½¬ HTMLï¼‰ä¹‹å‰è§¦å‘ | æœ€æ—©         | ç”¨äºä¿®æ”¹æ–‡ç« å†…å®¹çš„æºæ–‡ä»¶ï¼Œæ¯”å¦‚è§£æè‡ªå®šä¹‰æ ‡ç­¾æˆ–å‰ç½®å¤„ç† Markdown å†…å®¹ã€‚ |
| `after_post_render`  | åœ¨æ¸²æŸ“æ–‡ç« åï¼ˆHTML å·²ç”Ÿæˆï¼‰è§¦å‘           | è¾ƒæ—©         | ç”¨äºå¤„ç†æ–‡ç« æ¸²æŸ“åçš„ HTMLï¼Œæ¯”å¦‚æ·»åŠ è‡ªå®šä¹‰çš„ DOM æˆ–å±æ€§ã€‚     |
| `before_generate`    | åœ¨å¼€å§‹ç”Ÿæˆæ–‡ä»¶ä¹‹å‰è§¦å‘                    | ä¸­é—´         | ç”¨äºåœ¨æ–‡ä»¶ç”Ÿæˆå‰è¿›è¡Œç«™ç‚¹æ•°æ®çš„ä¿®æ”¹æˆ–å‡†å¤‡å·¥ä½œã€‚               |
| `after_generate`     | åœ¨æ‰€æœ‰æ–‡ä»¶ç”Ÿæˆå®Œæˆåè§¦å‘                  | è¾ƒæ™š         | ç”¨äºä¿®æ”¹ç”Ÿæˆåçš„æ–‡ä»¶æˆ–æ·»åŠ é¢å¤–æ–‡ä»¶ï¼Œé€šå¸¸ç”¨äº SEO ä¼˜åŒ–æˆ–ç¼“å­˜ç”Ÿæˆç­‰åå¤„ç†é€»è¾‘ã€‚ |
| `before_render`      | åœ¨æ¸²æŸ“æ–‡ä»¶ä¹‹å‰è§¦å‘                        | ä¾èµ–æƒ…å†µ     | æ¸²æŸ“æ‰€æœ‰ç±»å‹æ–‡ä»¶ï¼ˆä¸ä»…é™äºæ–‡ç« ï¼Œå¦‚æ¨¡æ¿ã€é¡µé¢ç­‰ï¼‰å‰è§¦å‘ï¼Œç”¨äºå…¨å±€æ€§ä¿®æ”¹ã€‚ |
| `after_render`       | åœ¨æ¸²æŸ“æ–‡ä»¶ä¹‹åè§¦å‘                        | ä¾èµ–æƒ…å†µ     | æ¸²æŸ“æ‰€æœ‰ç±»å‹æ–‡ä»¶åè§¦å‘ï¼Œå¸¸ç”¨äºå‹ç¼© HTMLã€CSS æˆ– JS æ–‡ä»¶ã€‚    |
| `before_exit`        | åœ¨ Hexo è¿›ç¨‹ç»“æŸä¹‹å‰è§¦å‘                  | æœ€æ™š         | ç”¨äºæ¸…ç†èµ„æºã€ä¿å­˜ç¼“å­˜ã€å†™æ—¥å¿—ç­‰é€€å‡ºå‰çš„æ“ä½œã€‚               |

</div>

## ç¤ºä¾‹ï¼š

```js
/**
 * AnZhiYu
 * lazyload
 * replace src to data-lazy-src
 */

"use strict";

const urlFor = require("hexo-util").url_for.bind(hexo);

const lazyload = htmlContent => {
  const error_img = hexo.theme.config.error_img.post_page
  const bg = hexo.theme.config.lazyload.placeholder
    ? urlFor(hexo.theme.config.lazyload.placeholder)
    : "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";
  return htmlContent.replace(
    /(<img(?!.class[\t]*=[\t]*['"].*?nolazyload.*?['"]).*? src=)/gi,
    `$1 "${bg}" data-lazy-src=`
  );
  //   return htmlContent.replace(
  //   /(<img(?!.class[\t]*=[\t]*['"].*?nolazyload.*?['"]).*? src=)/gi,
  //   `$1 "${bg}" onerror="this.onerror=null,this.src=&quot;${error_img}&quot;" data-lazy-src=`
  // );
}

hexo.extend.filter.register('after_render:html', data => {
  const { enable, field } = hexo.theme.config.lazyload
  if (!enable || field !== 'site') return
  return lazyload(data)
})

hexo.extend.filter.register('after_post_render', data => {
  const { enable, field } = hexo.theme.config.lazyload
  if (!enable || field !== 'post') return
  data.content = lazyload(data.content)
  return data
})

```
## äºŒã€hexoè¿‡æ»¤å™¨ è¡¥å……ï¼š
### å®Œæ•´çš„ hexo.extend.filter.register ç±»åˆ«æŒ‰æ‰§è¡Œé¡ºåºæ’åˆ—ï¼š

<div id = "md-table">

| **äº‹ä»¶**                   | **äº‹ä»¶åç§°ï¼ˆ`hexo.extend.filter.register` ç±»åˆ«ï¼‰**         | **æè¿°**                                                              |
|----------------------------|---------------------------------------------------------|-----------------------------------------------------------------------|
| **åˆå§‹åŒ–é˜¶æ®µ**              | `before_init` / `after_init`                             | åœ¨Hexoåˆå§‹åŒ–ä¹‹å‰å’Œä¹‹åè§¦å‘ï¼Œå…è®¸è‡ªå®šä¹‰é¡¹ç›®ç»“æ„å’Œé…ç½®ã€‚                |
| **æ¸…ç†ç¼“å­˜é˜¶æ®µ**            | `before_clean` / `after_clean`                           | åœ¨æ¸…ç†ç¼“å­˜ä¹‹å‰å’Œä¹‹åè§¦å‘ï¼Œç”¨äºåœ¨æ¸…ç†å‰åæ‰§è¡Œæ“ä½œã€‚                   |
| **åˆ›å»ºæ–°æ–‡ç« **              | `new_post`                                              | åœ¨åˆ›å»ºæ–°æ–‡ç« æ—¶è§¦å‘ï¼Œç”¨äºç”Ÿæˆæ–‡ç« æ–‡ä»¶æˆ–æ‰§è¡Œé¢å¤–çš„åˆå§‹åŒ–æ“ä½œã€‚         |
| **ç”Ÿæˆé˜¶æ®µ**                | `before_generate` / `after_generate`                     | åœ¨ç”Ÿæˆé¡µé¢å‰åè§¦å‘ï¼Œå…è®¸ä¿®æ”¹æˆ–å¤„ç†é¡µé¢å†…å®¹ã€‚                          |
| **æ¸²æŸ“é¡µé¢é˜¶æ®µ**            | `before_render` / `after_render`                         | åœ¨æ¸²æŸ“é¡µé¢å†…å®¹ä¹‹å‰å’Œä¹‹åè§¦å‘ï¼Œå…è®¸ä¿®æ”¹æ¸²æŸ“æµç¨‹æˆ–æ¸²æŸ“åçš„å†…å®¹ã€‚        |
| **æ¸²æŸ“HTMLé¡µé¢é˜¶æ®µ**        | `after_render:html`                                      | åœ¨HTMLæ¸²æŸ“å®Œæˆåè§¦å‘ï¼Œç”¨äºä¿®æ”¹æˆ–æ’å…¥HTMLç»“æ„ï¼Œä¾‹å¦‚SEOä¼˜åŒ–ç­‰ã€‚         |
| **å¤„ç†æ–‡ç« å†…å®¹é˜¶æ®µ**        | `before_post_render` / `after_post_render`               | æ–‡ç« æ¸²æŸ“å‰åè§¦å‘ï¼Œå¸¸ç”¨äºæ’å…¥æ–‡ç« çš„é™„åŠ å†…å®¹ï¼ˆå¦‚ç¤¾äº¤æŒ‰é’®ç­‰ï¼‰ã€‚           |
| **å†…å®¹å¤„ç†é˜¶æ®µ**            | `before_content_render` / `after_content_render`         | ç”¨äºæ–‡ç« å†…å®¹çš„æ¸²æŸ“å‰åï¼Œè¿›è¡Œå†…å®¹ä¿®æ”¹æˆ–æ ¼å¼åŒ–ã€‚                        |
| **éƒ¨ç½²é˜¶æ®µ**                | `before_deploy` / `after_deploy`                         | åœ¨éƒ¨ç½²ä¹‹å‰å’Œä¹‹åè§¦å‘ï¼Œç”¨äºè‡ªå®šä¹‰éƒ¨ç½²æµç¨‹ã€‚                            |
| **æœåŠ¡å™¨å¯åŠ¨é˜¶æ®µ**          | `before_serve` / `after_serve`                           | åœ¨æœ¬åœ°æœåŠ¡å™¨å¯åŠ¨å‰åè§¦å‘ï¼Œç”¨äºå¼€å‘ç¯å¢ƒä¸­çš„è°ƒè¯•å’Œä¼˜åŒ–ã€‚                |
| **å‘å¸ƒåå¤„ç†é˜¶æ®µ**          | `after_publish`                                          | åœ¨Hexoå‘å¸ƒåè§¦å‘ï¼Œé€šå¸¸ç”¨äºæ¸…ç†ã€æ—¥å¿—è®°å½•æˆ–å…¶ä»–åæœŸæ“ä½œã€‚             |

</div>


## ä¸‰ã€æ‹“å±•

**å¤‡ä»½**ï¼ˆ`filters`ã€`events`ã€`helpers`ç­‰ï¼‰**ä¸åŒç±»å‹**çš„hexoè„šæœ¬ï¼Œåœ¨hexoåŠ è½½æ—¶ï¼Œå¯èƒ½å¯¹é¡¹ç›®ä¼šæœ‰ä¸åŒç¨‹åº¦çš„å½±å“ã€‚

1. `filters (è¿‡æ»¤å™¨)` - ğŸš« æœ€æ˜“å—å½±å“ (é‡å¤æ‰§è¡Œ)

é—®é¢˜æœ¬è´¨ï¼š ä½¿ç”¨ hexo.extend.filter.register('filter_name', function(){...}) æ³¨å†Œçš„è¿‡æ»¤å™¨æ˜¯ å…¨å±€æ³¨å†Œ åˆ° Hexo å®ä¾‹ä¸Šçš„ã€‚

é‡å¤æ‰§è¡Œï¼š å¦‚æœåœ¨ ä¸¤ä¸ªä¸åŒçš„ .js æ–‡ä»¶ ä¸­ï¼ˆå³ä½¿æ˜¯ä¸»é¢˜ç›®å½•ä¸‹çš„ä¸åŒå­ç›®å½•ï¼‰ï¼Œæ³¨å†Œäº† åŒå çš„è¿‡æ»¤å™¨ï¼ˆ'filter_name'ï¼‰ï¼Œé‚£ä¹ˆ å½“è¯¥è¿‡æ»¤å™¨è¢«è§¦å‘æ—¶ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°éƒ½ä¼šè¢«æ‰§è¡Œï¼ˆå³ï¼Œæ‰§è¡Œäº†ä¸¤æ¬¡é€»è¾‘ï¼‰ï¼ æ‰§è¡Œé¡ºåºé€šå¸¸å–å†³äºæ–‡ä»¶åŠ è½½é¡ºåºï¼ˆæ–‡ä»¶åæ’åºæˆ–ç›®å½•ç»“æ„ï¼‰ã€‚

å½±å“èŒƒå›´ï¼š ä¸»é¢˜ç›®å½•ä¸‹çš„ scripts/ã€scripts/filters/ã€scripts/any-subfolder/ ç­‰ æ‰€æœ‰å­ç›®å½• ä¸­çš„è„šæœ¬æ–‡ä»¶ï¼Œåªè¦å®ƒä»¬è¢«åŠ è½½å¹¶æ³¨å†Œäº†åŒåè¿‡æ»¤å™¨ã€‚

2. `events (äº‹ä»¶)` - ğŸš« å—å½±å“ (é‡å¤æ‰§è¡Œ)

é—®é¢˜æœ¬è´¨ï¼š ä½¿ç”¨ hexo.on('event_name', function(){...}) ç›‘å¬ Hexo äº‹ä»¶ã€‚

é‡å¤æ‰§è¡Œï¼š å¦‚æœåœ¨ ä¸¤ä¸ªä¸åŒçš„ .js æ–‡ä»¶ ä¸­ç›‘å¬äº† åŒä¸€ä¸ªäº‹ä»¶ï¼ˆ'event_name'ï¼‰ï¼Œé‚£ä¹ˆ å½“è¯¥äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œè¿™ä¸¤ä¸ªç›‘å¬å‡½æ•°éƒ½ä¼šè¢«æ‰§è¡Œï¼

å½±å“èŒƒå›´ï¼š åŒæ ·å½±å“ä¸»é¢˜ç›®å½•ä¸‹ scripts/ã€scripts/events/ ç­‰æ‰€æœ‰å­ç›®å½•ä¸­çš„è„šæœ¬æ–‡ä»¶ã€‚

3. `helpers (è¾…åŠ©å‡½æ•°)` - âš ï¸ å½±å“æ–¹å¼ä¸åŒ (è¦†ç›–è€Œéé‡å¤æ‰§è¡Œ)

é—®é¢˜æœ¬è´¨ï¼š ä½¿ç”¨ hexo.extend.helper.register('helper_name', function(){...}) æ³¨å†Œçš„è¾…åŠ©å‡½æ•°ä¹Ÿæ˜¯ å…¨å±€æ³¨å†Œã€‚

é‡å¤æ³¨å†Œåæœï¼š å¦‚æœåœ¨ ä¸¤ä¸ªä¸åŒçš„ .js æ–‡ä»¶ ä¸­æ³¨å†Œäº† åŒå çš„è¾…åŠ©å‡½æ•°ï¼ˆ'helper_name'ï¼‰ï¼Œé‚£ä¹ˆ åæ³¨å†Œçš„å‡½æ•°ä¼šå®Œå…¨è¦†ç›–å…ˆæ³¨å†Œçš„å‡½æ•°ã€‚ æœ€ç»ˆåœ¨æ¨¡æ¿ä¸­è°ƒç”¨ helper_name() æ—¶ï¼Œåªä¼šæ‰§è¡Œæœ€åæ³¨å†Œçš„é‚£ä¸ªå‡½æ•°ã€‚

ä¸è¿‡æ»¤å™¨çš„åŒºåˆ«ï¼š å®ƒä¸ä¼šå¯¼è‡´å‡½æ•°è¢«æ‰§è¡Œå¤šæ¬¡ï¼Œä½†ä¼šå¯¼è‡´ é¢„æœŸå¤–çš„å‡½æ•°è¢«æ›¿æ¢ï¼ŒåŒæ ·ä¼šé€ æˆé—®é¢˜ï¼ˆåŠŸèƒ½å¤±æ•ˆæˆ–è¡Œä¸ºæ”¹å˜ï¼‰ã€‚

å½±å“èŒƒå›´ï¼š åŒæ ·å½±å“ä¸»é¢˜ç›®å½•ä¸‹ scripts/ã€scripts/helpers/ ç­‰æ‰€æœ‰å­ç›®å½•ä¸­çš„è„šæœ¬æ–‡ä»¶ã€‚

> ### æ€»ç»“ï¼š
> **`å¤‡ä»½è„šæœ¬`å¯èƒ½ä¼šå‡ºç°çš„`å†²çª`**
>
> 1. å‘ç”Ÿåœ¨`æ³¨å†Œçš„ç»„ä»¶å`ï¼ˆfilter_name, helper_name, event_nameï¼‰ä¸Šï¼Œè€Œ`ä¸æ˜¯æ–‡ä»¶å`ä¸Šã€‚ä»…ä»…ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶åï¼ˆæˆ–æ”¾åœ¨ä¸åŒå­ç›®å½•å¦‚ scripts/filters/ vs scripts/helpers/ï¼‰ï¼Œæ— æ³•éš”ç¦»åœ¨ hexo å…¨å±€å¯¹è±¡ä¸Šæ³¨å†Œçš„ç»„ä»¶ã€‚
> 2. `filters` å’Œ `events` ä¼šå¯¼è‡´ **é‡å¤æ‰§è¡Œ**ï¼Œè€Œ`helpers` ä¼šå¯¼è‡´ **è¦†ç›–**ã€‚è¿™æ˜¯ Hexo æ’ä»¶/è„šæœ¬æœºåˆ¶å†³å®šçš„ã€‚
>
> **å¦‚ä½•å¤‡ä»½è„šæœ¬æ‰èƒ½`é¿å…å†²çª`?**
> 1. å°†å¤‡ä»½è„šæœ¬ä¸­çš„ hexo.extend.filter.registerã€hexo.extend.helper.registerã€hexo.on ç­‰å…³é”®æ³¨å†Œè¡Œç›´æ¥ç”¨ // æˆ– /* */ `æ³¨é‡Šæ‰`ï¼Œç¡®ä¿å®ƒä»¬ä¸ä¼šè¢«æ‰§è¡Œã€‚è¿™æ˜¯æ¯”è¾ƒå¯é çš„æ‰‹åŠ¨æ–¹æ³•ã€‚
> 2. å°†æ‰€è¦å¤‡ä»½çš„hexoè„šæœ¬ï¼Œ`ç§»å‡ºhexoåŠ è½½è·¯å¾„`ã€‚